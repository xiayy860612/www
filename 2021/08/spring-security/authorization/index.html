<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"amos.s2u2m.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Spring Security 鉴权设计">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security --- Authorization">
<meta property="og:url" content="https://amos.s2u2m.com/2021/08/spring-security/authorization/index.html">
<meta property="og:site_name" content="观澜">
<meta property="og:description" content="Spring Security 鉴权设计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://amos.s2u2m.com/2021/08/spring-security/authorization/access-decision-voting.png">
<meta property="og:image" content="https://amos.s2u2m.com/2021/08/spring-security/authorization/after-invocation.png">
<meta property="og:image" content="https://amos.s2u2m.com/2021/08/spring-security/authorization/filtersecurityinterceptor.png">
<meta property="article:published_time" content="2021-08-27T00:58:54.000Z">
<meta property="article:modified_time" content="2021-12-24T05:38:15.767Z">
<meta property="article:author" content="Amos">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Spring Security">
<meta property="article:tag" content="鉴权">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://amos.s2u2m.com/2021/08/spring-security/authorization/access-decision-voting.png">

<link rel="canonical" href="https://amos.s2u2m.com/2021/08/spring-security/authorization/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring Security --- Authorization | 观澜</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">观澜</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">行到水穷处，坐看云起时</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://amos.s2u2m.com/2021/08/spring-security/authorization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Amos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="观澜">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Security --- Authorization
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-27 08:58:54" itemprop="dateCreated datePublished" datetime="2021-08-27T08:58:54+08:00">2021-08-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-24 13:38:15" itemprop="dateModified" datetime="2021-12-24T13:38:15+08:00">2021-12-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring-Security/" itemprop="url" rel="index"><span itemprop="name">Spring Security</span></a>
                </span>
            </span>

          
            <span id="/2021/08/spring-security/authorization/" class="post-meta-item leancloud_visitors" data-flag-title="Spring Security --- Authorization" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/spring-security/authorization/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/spring-security/authorization/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>
            <div class="post-description">Spring Security 鉴权设计</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Spring Security提供了以下几种方式进行鉴权:</p>
<ul>
<li>pre-invocation handling, 在使用被保护资源之前进行鉴权</li>
<li>after invocation handling， 对调用后返回的被保护资源， 通过鉴权进行过滤</li>
<li>FilterSecurityInterceptor, 在请求处理链中根据请求进行鉴权</li>
<li>基于SpEL(Spring Expression Language)， 通过注解对被保护资源进行鉴权</li>
</ul>
<a id="more"></a>

<h2 id="Architecture-Core"><a href="#Architecture-Core" class="headerlink" title="Architecture Core"></a>Architecture Core</h2><h3 id="Pre-Invocation-Handling"><a href="#Pre-Invocation-Handling" class="headerlink" title="Pre-Invocation Handling"></a>Pre-Invocation Handling</h3><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="382px" preserveAspectRatio="none" style="width:1944px;height:382px;background:#FFFFFF;" version="1.1" viewBox="0 0 1944 382" width="1944px" zoomAndPan="magnify"><defs/><g><!--MD5=[afcb8546e38fd0254ebcf2f9ef9d8004]
cluster Authorization--><g id="cluster_Authorization"><path d="M8.5,118 L122.5,118 A3.75,3.75 0 0 1 125,120.5 L132,140.2969 L1437.5,140.2969 A2.5,2.5 0 0 1 1440,142.7969 L1440,372.5 A2.5,2.5 0 0 1 1437.5,375 L8.5,375 A2.5,2.5 0 0 1 6,372.5 L6,120.5 A2.5,2.5 0 0 1 8.5,118 " style="stroke:#000000;stroke-width:1.5;fill:none;"/><line style="stroke:#000000;stroke-width:1.5;fill:none;" x1="6" x2="132" y1="140.2969" y2="140.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="113" x="10" y="132.9951">Authorization</text></g><!--MD5=[e3e144d13ada41eaab5375ff982d1fe4]
class GrantedAuthority--><g id="elem_GrantedAuthority"><rect codeLine="3" fill="#F1F1F1" height="64.2969" id="GrantedAuthority" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="22" y="169.5"/><ellipse cx="42.85" cy="185.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M43.8031,182.2813 L45.5219,182.2813 C45.9125,182.2813 46.1,182.25 46.225,182.1719 C46.4906,182.0156 46.6313,181.7344 46.6313,181.4375 C46.6313,181.1719 46.5219,180.9063 46.2875,180.7344 C46.1156,180.625 45.975,180.5938 45.5219,180.5938 L40.3813,180.5938 C39.9438,180.5938 39.8188,180.6094 39.6625,180.7031 C39.4125,180.8594 39.2563,181.1563 39.2563,181.4375 C39.2563,181.7188 39.3969,181.9688 39.6156,182.1406 C39.7719,182.25 39.9594,182.2813 40.3813,182.2813 L42.1,182.2813 L42.1,188.7969 L40.3813,188.7969 C39.9438,188.7969 39.8188,188.8125 39.6625,188.9219 C39.4125,189.0781 39.2563,189.3594 39.2563,189.6563 C39.2563,189.9063 39.3969,190.1719 39.6156,190.3281 C39.7719,190.4531 39.975,190.5 40.3813,190.5 L45.5219,190.5 C46.2719,190.5 46.6313,190.2188 46.6313,189.6563 C46.6313,189.375 46.5219,189.125 46.2875,188.9531 C46.1156,188.8281 45.975,188.7969 45.5219,188.7969 L43.8031,188.7969 L43.8031,182.2813 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="123" x="58.15" y="190.3467">GrantedAuthority</text><line style="stroke:#181818;stroke-width:0.5;" x1="23" x2="189" y1="201.5" y2="201.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="23" x2="189" y1="209.5" y2="209.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="28" y="226.4951">String getAuthority();</text></g><g id="elem_GMN53460"><path d="M225,181.5 L225,197.5 L190.404,201.5 L225,205.5 L225,221.7656 A0,0 0 0 0 225,221.7656 L417,221.7656 A0,0 0 0 0 417,221.7656 L417,191.5 L407,181.5 L225,181.5 A0,0 0 0 0 225,181.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M407,181.5 L407,191.5 L417,191.5 L407,181.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="231" y="198.5669">如果无法用String进行描述，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="231" y="213.6997">则需返回null</text></g><!--MD5=[adc8916905935507507a42e1b12cf196]
class SimpleGrantedAuthority--><g id="elem_SimpleGrantedAuthority"><rect codeLine="11" fill="#F1F1F1" height="48" id="SimpleGrantedAuthority" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="209" x="22.5" y="311"/><ellipse cx="37.5" cy="327" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M39.8438,322.6719 C38.9063,322.2344 38.3125,322.0938 37.4375,322.0938 C34.8125,322.0938 32.8125,324.1719 32.8125,326.8906 L32.8125,328.0156 C32.8125,330.5938 34.9219,332.4844 37.8125,332.4844 C39.0313,332.4844 40.1875,332.1875 40.9375,331.6406 C41.5156,331.2344 41.8438,330.7813 41.8438,330.3906 C41.8438,329.9375 41.4531,329.5469 40.9844,329.5469 C40.7656,329.5469 40.5625,329.625 40.375,329.8125 C39.9219,330.2969 39.9219,330.2969 39.7344,330.3906 C39.3125,330.6563 38.625,330.7813 37.8594,330.7813 C35.8125,330.7813 34.5156,329.6875 34.5156,327.9844 L34.5156,326.8906 C34.5156,325.1094 35.7656,323.7969 37.5,323.7969 C38.0781,323.7969 38.6875,323.9531 39.1563,324.2031 C39.6406,324.4844 39.8125,324.7031 39.9063,325.1094 C39.9688,325.5156 40,325.6406 40.1406,325.7656 C40.2813,325.9063 40.5156,326.0156 40.7344,326.0156 C41,326.0156 41.2656,325.875 41.4375,325.6563 C41.5469,325.5 41.5781,325.3125 41.5781,324.8906 L41.5781,323.4688 C41.5781,323.0313 41.5625,322.9063 41.4688,322.75 C41.3125,322.4844 41.0313,322.3438 40.7344,322.3438 C40.4375,322.3438 40.2344,322.4375 40.0156,322.75 L39.8438,322.6719 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177" x="51.5" y="331.8467">SimpleGrantedAuthority</text><line style="stroke:#181818;stroke-width:0.5;" x1="23.5" x2="230.5" y1="343" y2="343"/><line style="stroke:#181818;stroke-width:0.5;" x1="23.5" x2="230.5" y1="351" y2="351"/></g><!--MD5=[3c3699dab3baf2740bb151cfc90fd64b]
class AccessDecisionManager--><g id="elem_AccessDecisionManager"><rect codeLine="13" fill="#F1F1F1" height="96.8906" id="AccessDecisionManager" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="971" x="452.5" y="153"/><ellipse cx="847.25" cy="169" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M848.2031,165.7813 L849.9219,165.7813 C850.3125,165.7813 850.5,165.75 850.625,165.6719 C850.8906,165.5156 851.0313,165.2344 851.0313,164.9375 C851.0313,164.6719 850.9219,164.4063 850.6875,164.2344 C850.5156,164.125 850.375,164.0938 849.9219,164.0938 L844.7813,164.0938 C844.3438,164.0938 844.2188,164.1094 844.0625,164.2031 C843.8125,164.3594 843.6563,164.6563 843.6563,164.9375 C843.6563,165.2188 843.7969,165.4688 844.0156,165.6406 C844.1719,165.75 844.3594,165.7813 844.7813,165.7813 L846.5,165.7813 L846.5,172.2969 L844.7813,172.2969 C844.3438,172.2969 844.2188,172.3125 844.0625,172.4219 C843.8125,172.5781 843.6563,172.8594 843.6563,173.1563 C843.6563,173.4063 843.7969,173.6719 844.0156,173.8281 C844.1719,173.9531 844.375,174 844.7813,174 L849.9219,174 C850.6719,174 851.0313,173.7188 851.0313,173.1563 C851.0313,172.875 850.9219,172.625 850.6875,172.4531 C850.5156,172.3281 850.375,172.2969 849.9219,172.2969 L848.2031,172.2969 L848.2031,165.7813 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="173" x="867.75" y="173.8467">AccessDecisionManager</text><line style="stroke:#181818;stroke-width:0.5;" x1="453.5" x2="1422.5" y1="185" y2="185"/><line style="stroke:#181818;stroke-width:0.5;" x1="453.5" x2="1422.5" y1="193" y2="193"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="959" x="458.5" y="209.9951">void decide(Authentication authentication, Object secureObject, Collection&lt;ConfigAttribute&gt; attrs) throws AccessDeniedException;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="326" x="458.5" y="226.292">boolean supports(ConfigAttribute attribute);</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="458.5" y="242.5889">boolean supports(Class clazz);</text></g><!--MD5=[a139e992f8a77546bf37c14edd197f06]
class Authentication--><g id="elem_Authentication"><rect codeLine="21" fill="#F1F1F1" height="48" id="Authentication" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136" x="474" y="7"/><ellipse cx="489" cy="23" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M489.9531,19.7813 L491.6719,19.7813 C492.0625,19.7813 492.25,19.75 492.375,19.6719 C492.6406,19.5156 492.7813,19.2344 492.7813,18.9375 C492.7813,18.6719 492.6719,18.4063 492.4375,18.2344 C492.2656,18.125 492.125,18.0938 491.6719,18.0938 L486.5313,18.0938 C486.0938,18.0938 485.9688,18.1094 485.8125,18.2031 C485.5625,18.3594 485.4063,18.6563 485.4063,18.9375 C485.4063,19.2188 485.5469,19.4688 485.7656,19.6406 C485.9219,19.75 486.1094,19.7813 486.5313,19.7813 L488.25,19.7813 L488.25,26.2969 L486.5313,26.2969 C486.0938,26.2969 485.9688,26.3125 485.8125,26.4219 C485.5625,26.5781 485.4063,26.8594 485.4063,27.1563 C485.4063,27.4063 485.5469,27.6719 485.7656,27.8281 C485.9219,27.9531 486.125,28 486.5313,28 L491.6719,28 C492.4219,28 492.7813,27.7188 492.7813,27.1563 C492.7813,26.875 492.6719,26.625 492.4375,26.4531 C492.2656,26.3281 492.125,26.2969 491.6719,26.2969 L489.9531,26.2969 L489.9531,19.7813 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="104" x="503" y="27.8467">Authentication</text><line style="stroke:#181818;stroke-width:0.5;" x1="475" x2="609" y1="39" y2="39"/><line style="stroke:#181818;stroke-width:0.5;" x1="475" x2="609" y1="47" y2="47"/></g><!--MD5=[e01a0f457b12b1c790c8336f0238b7d5]
class AbstractSecurityInterceptor--><g id="elem_AbstractSecurityInterceptor"><rect codeLine="25" fill="#F1F1F1" height="48" id="AbstractSecurityInterceptor" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="238" x="1455" y="7"/><ellipse cx="1470" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1472.3438,18.6719 C1471.4063,18.2344 1470.8125,18.0938 1469.9375,18.0938 C1467.3125,18.0938 1465.3125,20.1719 1465.3125,22.8906 L1465.3125,24.0156 C1465.3125,26.5938 1467.4219,28.4844 1470.3125,28.4844 C1471.5313,28.4844 1472.6875,28.1875 1473.4375,27.6406 C1474.0156,27.2344 1474.3438,26.7813 1474.3438,26.3906 C1474.3438,25.9375 1473.9531,25.5469 1473.4844,25.5469 C1473.2656,25.5469 1473.0625,25.625 1472.875,25.8125 C1472.4219,26.2969 1472.4219,26.2969 1472.2344,26.3906 C1471.8125,26.6563 1471.125,26.7813 1470.3594,26.7813 C1468.3125,26.7813 1467.0156,25.6875 1467.0156,23.9844 L1467.0156,22.8906 C1467.0156,21.1094 1468.2656,19.7969 1470,19.7969 C1470.5781,19.7969 1471.1875,19.9531 1471.6563,20.2031 C1472.1406,20.4844 1472.3125,20.7031 1472.4063,21.1094 C1472.4688,21.5156 1472.5,21.6406 1472.6406,21.7656 C1472.7813,21.9063 1473.0156,22.0156 1473.2344,22.0156 C1473.5,22.0156 1473.7656,21.875 1473.9375,21.6563 C1474.0469,21.5 1474.0781,21.3125 1474.0781,20.8906 L1474.0781,19.4688 C1474.0781,19.0313 1474.0625,18.9063 1473.9688,18.75 C1473.8125,18.4844 1473.5313,18.3438 1473.2344,18.3438 C1472.9375,18.3438 1472.7344,18.4375 1472.5156,18.75 L1472.3438,18.6719 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206" x="1484" y="27.8467">AbstractSecurityInterceptor</text><line style="stroke:#181818;stroke-width:0.5;" x1="1456" x2="1692" y1="39" y2="39"/><line style="stroke:#181818;stroke-width:0.5;" x1="1456" x2="1692" y1="47" y2="47"/></g><!--MD5=[4c5e0ce7b787264d781aeccfd2b745f9]
class MethodSecurityInterceptor--><g id="elem_MethodSecurityInterceptor"><rect codeLine="28" fill="#F1F1F1" height="48" id="MethodSecurityInterceptor" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="230" x="1459" y="177.5"/><ellipse cx="1474" cy="193.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1476.3438,189.1719 C1475.4063,188.7344 1474.8125,188.5938 1473.9375,188.5938 C1471.3125,188.5938 1469.3125,190.6719 1469.3125,193.3906 L1469.3125,194.5156 C1469.3125,197.0938 1471.4219,198.9844 1474.3125,198.9844 C1475.5313,198.9844 1476.6875,198.6875 1477.4375,198.1406 C1478.0156,197.7344 1478.3438,197.2813 1478.3438,196.8906 C1478.3438,196.4375 1477.9531,196.0469 1477.4844,196.0469 C1477.2656,196.0469 1477.0625,196.125 1476.875,196.3125 C1476.4219,196.7969 1476.4219,196.7969 1476.2344,196.8906 C1475.8125,197.1563 1475.125,197.2813 1474.3594,197.2813 C1472.3125,197.2813 1471.0156,196.1875 1471.0156,194.4844 L1471.0156,193.3906 C1471.0156,191.6094 1472.2656,190.2969 1474,190.2969 C1474.5781,190.2969 1475.1875,190.4531 1475.6563,190.7031 C1476.1406,190.9844 1476.3125,191.2031 1476.4063,191.6094 C1476.4688,192.0156 1476.5,192.1406 1476.6406,192.2656 C1476.7813,192.4063 1477.0156,192.5156 1477.2344,192.5156 C1477.5,192.5156 1477.7656,192.375 1477.9375,192.1563 C1478.0469,192 1478.0781,191.8125 1478.0781,191.3906 L1478.0781,189.9688 C1478.0781,189.5313 1478.0625,189.4063 1477.9688,189.25 C1477.8125,188.9844 1477.5313,188.8438 1477.2344,188.8438 C1476.9375,188.8438 1476.7344,188.9375 1476.5156,189.25 L1476.3438,189.1719 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198" x="1488" y="198.3467">MethodSecurityInterceptor</text><line style="stroke:#181818;stroke-width:0.5;" x1="1460" x2="1688" y1="209.5" y2="209.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="1460" x2="1688" y1="217.5" y2="217.5"/></g><!--MD5=[5fe0d3603d5d9cbabcbd5016fbeda9e2]
class FilterSecurityInterceptor--><g id="elem_FilterSecurityInterceptor"><rect codeLine="30" fill="#F1F1F1" height="48" id="FilterSecurityInterceptor" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="1724.5" y="177.5"/><ellipse cx="1739.5" cy="193.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1741.8438,189.1719 C1740.9063,188.7344 1740.3125,188.5938 1739.4375,188.5938 C1736.8125,188.5938 1734.8125,190.6719 1734.8125,193.3906 L1734.8125,194.5156 C1734.8125,197.0938 1736.9219,198.9844 1739.8125,198.9844 C1741.0313,198.9844 1742.1875,198.6875 1742.9375,198.1406 C1743.5156,197.7344 1743.8438,197.2813 1743.8438,196.8906 C1743.8438,196.4375 1743.4531,196.0469 1742.9844,196.0469 C1742.7656,196.0469 1742.5625,196.125 1742.375,196.3125 C1741.9219,196.7969 1741.9219,196.7969 1741.7344,196.8906 C1741.3125,197.1563 1740.625,197.2813 1739.8594,197.2813 C1737.8125,197.2813 1736.5156,196.1875 1736.5156,194.4844 L1736.5156,193.3906 C1736.5156,191.6094 1737.7656,190.2969 1739.5,190.2969 C1740.0781,190.2969 1740.6875,190.4531 1741.1563,190.7031 C1741.6406,190.9844 1741.8125,191.2031 1741.9063,191.6094 C1741.9688,192.0156 1742,192.1406 1742.1406,192.2656 C1742.2813,192.4063 1742.5156,192.5156 1742.7344,192.5156 C1743,192.5156 1743.2656,192.375 1743.4375,192.1563 C1743.5469,192 1743.5781,191.8125 1743.5781,191.3906 L1743.5781,189.9688 C1743.5781,189.5313 1743.5625,189.4063 1743.4688,189.25 C1743.3125,188.9844 1743.0313,188.8438 1742.7344,188.8438 C1742.4375,188.8438 1742.2344,188.9375 1742.0156,189.25 L1741.8438,189.1719 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="1753.5" y="198.3467">FilterSecurityInterceptor</text><line style="stroke:#181818;stroke-width:0.5;" x1="1725.5" x2="1936.5" y1="209.5" y2="209.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="1725.5" x2="1936.5" y1="217.5" y2="217.5"/></g><!--MD5=[21678046347684f21267eb307531f970]
reverse link GrantedAuthority to SimpleGrantedAuthority--><g id="link_GrantedAuthority_SimpleGrantedAuthority"><path d="M114.168,253.65 C117.326,273.421 120.779,295.0471 123.308,310.878 " fill="none" id="GrantedAuthority-backto-SimpleGrantedAuthority" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="107.218,254.517,110.977,233.664,121.043,252.31,107.218,254.517" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[94b1c8ac123e57f9c08f65047d00cbde]
link Authentication to GrantedAuthority--><g id="link_Authentication_GrantedAuthority"><path codeLine="22" d="M461.8201,39.3126 C461.8201,39.3126 287.376,68.187 207,110 C183.032,122.468 160.258,141.942 142.423,159.637 " fill="none" id="Authentication-GrantedAuthority" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="133.047,169.228,142.1987,165.5884,136.5422,165.6526,136.478,159.9961,133.047,169.228" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="136.5422" x2="142.1345" y1="165.6526" y2="159.9315"/><polygon fill="#181818" points="473.73,37.845,467.2858,34.6088,461.8201,39.3126,468.2643,42.5488,473.73,37.845" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="457.8255" y="34.8475">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="130.6828" y="158.4486">*</text></g><!--MD5=[615aec758c455ffb3b5402a613d9cd9c]
link AccessDecisionManager to Authentication--><g id="link_AccessDecisionManager_Authentication"><path codeLine="23" d="M825.99,152.839 C752.872,121.727 660.337,82.353 601.144,57.166 " fill="none" id="AccessDecisionManager-to-Authentication" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="596.232,55.076,602.9465,62.2813,600.8326,57.0342,606.0796,54.9203,596.232,55.076" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="705" y="98.0669">decide鉴权</text></g><!--MD5=[5b92f5be657d035532bac2e02abcc607]
link AbstractSecurityInterceptor to AccessDecisionManager--><g id="link_AbstractSecurityInterceptor_AccessDecisionManager"><path codeLine="26" d="M1486.9,55.076 C1393.53,79.812 1242.55,119.814 1122.54,151.608 " fill="none" id="AbstractSecurityInterceptor-to-AccessDecisionManager" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1117.57,152.926,1127.2957,154.4784,1122.402,151.6409,1125.2396,146.7472,1117.57,152.926" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="1369" y="98.0669">use</text></g><!--MD5=[f785b2081df05a5715f1980537338c71]
reverse link AbstractSecurityInterceptor to MethodSecurityInterceptor--><g id="link_AbstractSecurityInterceptor_MethodSecurityInterceptor"><path d="M1574,75.091 C1574,107.682 1574,151.167 1574,177.433 " fill="none" id="AbstractSecurityInterceptor-backto-MethodSecurityInterceptor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1567,75.076,1574,55.076,1581,75.076,1567,75.076" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[6b5cbb4b6d75008ea5caf62a6958160d]
reverse link AbstractSecurityInterceptor to FilterSecurityInterceptor--><g id="link_AbstractSecurityInterceptor_FilterSecurityInterceptor"><path d="M1633.13,64.982 C1656.46,78.434 1683.3,94.46 1707,110 C1739.98,131.631 1776.27,158.499 1801.02,177.319 " fill="none" id="AbstractSecurityInterceptor-backto-FilterSecurityInterceptor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1629.59,71.021,1615.69,55.026,1636.53,58.862,1629.59,71.021" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[6b0786b82feed1a7710c0cdec6b2e6c0]
@startuml
package Authorization {

interface GrantedAuthority {
    String getAuthority();
}
note left
如果无法用String进行描述， 
则需返回null
end note

class SimpleGrantedAuthority implements GrantedAuthority

interface AccessDecisionManager {
    void decide(Authentication authentication, Object secureObject, Collection<ConfigAttribute> attrs) throws AccessDeniedException;
    boolean supports(ConfigAttribute attribute);
    boolean supports(Class clazz);
}

}

interface Authentication
Authentication "1" *- -> "*" GrantedAuthority
AccessDecisionManager - -> Authentication: decide鉴权

class AbstractSecurityInterceptor
AbstractSecurityInterceptor - -> AccessDecisionManager: use

class MethodSecurityInterceptor extends AbstractSecurityInterceptor

class FilterSecurityInterceptor extends AbstractSecurityInterceptor
@enduml

PlantUML version 1.2022.2(Sat Mar 05 16:30:19 UTC 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>

<ul>
<li>GrantedAuthority, 描述用户的权限</li>
<li>AccessDecisionManager， 决定用户是否有对受保护资源的访问权限</li>
</ul>
<p>在访问受保护资源之前， 对用户进行鉴权</p>
<p><img src="/2021/08/spring-security/authorization/access-decision-voting.png"></p>
<h3 id="After-Invocation-Handling"><a href="#After-Invocation-Handling" class="headerlink" title="After Invocation Handling"></a>After Invocation Handling</h3><p>对方法放回的值根据用户权限进行再过滤，只返回用户可以访问的资源</p>
<p><img src="/2021/08/spring-security/authorization/after-invocation.png"></p>
<ul>
<li>PostInvocationAdviceProvider, 当使用@PostAuthorize和@PostFilter注解时调用</li>
</ul>
<h2 id="FilterSecurityInterceptor"><a href="#FilterSecurityInterceptor" class="headerlink" title="FilterSecurityInterceptor"></a>FilterSecurityInterceptor</h2><p>在调用链中对请求进行鉴权</p>
<p><img src="/2021/08/spring-security/authorization/filtersecurityinterceptor.png"></p>
<h2 id="基于SpEL-Spring-Expression-Language"><a href="#基于SpEL-Spring-Expression-Language" class="headerlink" title="基于SpEL(Spring Expression Language)"></a>基于SpEL(Spring Expression Language)</h2><p>Spring Security 3.0引入， 通过注解对被保护资源进行鉴权</p>
<ul>
<li>内置校验表达式，返回boolean进行校验，常用的有：<ul>
<li><code>hasRole</code></li>
<li><code>hasPermission</code></li>
<li><code>authentication</code>, 访问Authentication对象</li>
<li><code>principal</code>，访问当前对象</li>
</ul>
</li>
<li><code>@&lt;bean_name&gt;.&lt;function&gt;</code>, 引用bean中返回boolean的方法</li>
<li><code>#&lt;path_variable&gt;</code>, 引用方法参数列表中的变量</li>
</ul>
<p>通过<code>EnableGlobalMethodSecurity注解</code>开启@Pre和@Post注解功能:</p>
<ul>
<li>@PreAuthorize, 对方法是否可以访问进行校验</li>
<li>@PostAuthorize注解， 可通过<code>returnObject</code>来引用返回值,<br>校验用户是否可以访问返回对象</li>
<li>@PreFilter, 对方法参数列表中的Iterable的对象进行过滤，</li>
<li>@PostFilter注解，对方法返回的Iterable对象进行过滤，<br>可通过<code>filterObject</code>来引用方法返回值</li>
</ul>
<p>优先通过PreFilter进行过滤，避免后续大量无效数据的获取</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-authorization">Spring Security Authorization</a></li>
<li><a href="">JSR-250</a></li>
<li><a href="">ACL</a></li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/01/spring-security/architecture/" rel="bookmark">Spring Security --- Architecture</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/02/spring-security/authentication/" rel="bookmark">Spring Security --- Authentication</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2018/05/spring/request-workflow/" rel="bookmark">Spring --- 请求处理流程</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2022/03/spring/spring-mvc/" rel="bookmark">Spring MVC RESTfull请求处理流程</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Amos
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://amos.s2u2m.com/2021/08/spring-security/authorization/" title="Spring Security --- Authorization">https://amos.s2u2m.com/2021/08/spring-security/authorization/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/Spring-Security/" rel="tag"># Spring Security</a>
              <a href="/tags/%E9%89%B4%E6%9D%83/" rel="tag"># 鉴权</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/MySQL/backup-rollback/" rel="prev" title="MySQL备份和恢复">
      <i class="fa fa-chevron-left"></i> MySQL备份和恢复
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/rabbitmq/best-practice/" rel="next" title="RabbitMQ 开发实践">
      RabbitMQ 开发实践 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Architecture-Core"><span class="nav-number">1.</span> <span class="nav-text">Architecture Core</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pre-Invocation-Handling"><span class="nav-number">1.1.</span> <span class="nav-text">Pre-Invocation Handling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#After-Invocation-Handling"><span class="nav-number">1.2.</span> <span class="nav-text">After Invocation Handling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FilterSecurityInterceptor"><span class="nav-number">2.</span> <span class="nav-text">FilterSecurityInterceptor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8ESpEL-Spring-Expression-Language"><span class="nav-number">3.</span> <span class="nav-text">基于SpEL(Spring Expression Language)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Amos"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Amos</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:xiayy860612@126.com" title="E-Mail → mailto:xiayy860612@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/xiayy860612" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiayy860612" rel="noopener" target="_blank"><i class="fa fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备18013492号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">s2u2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">33k</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'YnmrykAQHQwGzUR77I61DkKN-9Nh9j0Va',
      appKey     : '4TzKa97Pz2JTg81B8o5l77mO',
      placeholder: "一起来聊一聊呗",
      avatar     : 'retro',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
