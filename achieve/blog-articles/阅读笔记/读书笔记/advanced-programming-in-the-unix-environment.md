# UNIX环境高级编程

UNIX环境高级编程学习笔记
<!--more-->

# 系统调用(内核)和库函数
- 系统调用通常不能被替换，而库函数可以被替换。
- 库函数可以调用系统调用来实现功能
- 系统调用提供一种最小接口，而库函数通常提供比较复杂的功能。

# I/O
# 文件描述符

## Unbuffered I/O
不带缓冲的I/O的Function:
- read
- write

# Process
- 内核使程序执行的唯一方法是调用exec函数
- 进程结束，从main返回会调用exit函数，它会调用所有终止处理程序，然后关闭所有打开流，最后回到内核。
- 使用atexit注册终止处理程序
- 存储布局：
    1. 正文段
    2. 初始化数据段
    3. 未初始化数据段
    4. 堆
    5. 栈
- 存放在磁盘文件上的段只有正文段以及初始化数据段
- 内存分配函数
    + malloc
    + calloc
    + realloc
    + free

## 存储空间分配程序
可用来替代malloc和free的函数。
- libmalloc
- quick-fit
- jemaalloc
- TCMalloc
- alloca

## 进程ID
使用非负整型来表示唯一进程ID。进程ID是可复用的，当进程结束时，进程ID会成为复用的候选者。大多数UNIX系统实现**延迟复用算法**。

专用进程
- 交换进程/调度进程/系统进程，进程ID为0，内核的一部分。
- init进程，进程ID为1，在自举过程(bootstrap)结束时由内核调用，负责启动系统。
它是一个普通的用户进程，但以超级用户特权运行，并永不终止。

fork函数用来创建一个子进程，调用一次，但返回2次: 
- 子进程返回0
- 父进程返回子进程的进程ID

spawn = fork + exec

如果父进程在子进程之前结束，则所有子进程的父进程都改变为init进程。

僵死进程(zombie): 一个已经终止，但是其父进程尚未对其进行善后处理的进程。

使用fork创建子进程后，子进程调用exec以执行另一个程序。
exec函数用磁盘上的指定程序替换当前进程的正文段，数据段，堆段和栈段。

##　实际用户ID && 有效用户ID
- 只有超级用户进程才可以更改实际用户ID，通常实际用户ID是由login程序设置，并且绝不改变它。

## 解释器文件(interpreter file)
文件格式：

    #! interpreter_path [optional-argument]

解释器文件的识别由内核作为exec系统调用的一部分处理来完成。
内核调用exec函数执行解释器文件的第一行中interpreter_path指定的程序。

## 进程时间
- 时钟时间，进程运行的总时间，与系统中同时运行的进程数相关。
- 用户CPU时间，用户指令所用的时间。
- 系统CPU时间，进程执行内核程序所花的时间

CPU时间 = 用户CPU时间 + 系统CPU时间

# 信号
信号是软件中断，提供了一种处理异步事件的方法。

# 进程间通信(IPC)
- 半双工管道Pipe
    + 数据只能在一个方向上流动
    + 所有的Unix系统都提供此种通信机制
    + 只能在相关联的进程之间使用，即两个进程拥有共同的祖先
- 命名管道FIFO
    + 可用于不相干的的进程之间进行数据交换
- 消息队列
- 信号量，它是一个计数器，用于为多个进程提供对共享数据对象的访问。
- 记录锁
- 共享存储
- 套接字Socket
- 域套接字，用于同一台机器上运行的进程之间的通信
- 

