# 计算机网络: 自顶向下方法

[计算机网络: 自顶向下方法](https://book.douban.com/subject/26176870/)

[配套学习资料](http://wps.pearsoned.com/ecs_kurose_compnetw_6/216/55463/14198700.cw/index.html)

<!-- more -->

# Basic
- 网络(network)是由一组具有通信能力的设备相互连接而形成的。
- 互联网是由链路和交换机组成的，由一系列主干网，提供商网络和客户网络组成。
- 主干网络通过对等点(peering point)的复杂交换系统进行连接。
- 主干网络和提供商网络也被成为Internet服务提供商(ISP)

## TCP/IP协议簇的一般层次划分
1. 物理层
2. 数据链路层
3. 网络层
    - IP
    - ICMP
    - IGMP
    - DHCP
    - ARP
4. 传输层
    - TCP
    - UDP
    - SCTP
5. 应用层
    - Http
    - FTP
    - SMTP
    - SSH
    - TELNET
    - DNS

上三层(应用层,传输层,网络层)的任务是端到端(end-to-end)的，
其任务范围是互联网，其数据单元(分组)不应该被任何路由器或者链路层交换机改变。

低二层(数据链路层,物理层)的任务是点到点(point-to-point)的，
其任务范围是链路，主机创建的分组仅被路由器改变，链路层交换机不会改变它们。

封装/解封会发生在上三层，不会发生在低二层。

- 多路复用(multiplexing), 一个协议能够封装来自多个上层协议的分组, 一次一个.
- 多路分解(demultiplexing), 一个协议能够进行解封装，并且将分组投递到多个上层协议, 一次一个.

操作系统封装了TCP/IP协议簇的前四层(物理层,数据链路层,网络层,传输层),
并提供了一系列通信接口。
- 套接字接口Socket
- 传输层接口TLI
- Stream

# 应用层

## 应用层模式
- 客户-服务器模式(client-server)
    + 通信负荷集中在服务器
- 对等模式(P2P, peer-to-peer)
- 混合模式

## 万维网(WWW)
- 统一资源定位符(URL)
    + 协议，用来获取网页的运载工具形式。
    + 主机，端口，路径，三者的组合定义了目的对象
- 万维网的文档可分为三类：
    + 静态文档
    + 动态文档
    + 活动文档，比如JavaScript脚本

### Cookie
- 浏览器在cookie目录中存储cookie，并根据服务器域名进行分类
- cookie的内容不让浏览器或者用户读取，由服务器创建并收回。

## 超文本传输协议(HTTP)
- 非持续连接，每次使用新的TCP连接获取网页中的每一个对象。
HTTP1.1之前默认指定了非持续连接
    + 给服务器带来高额开销，每次获取网页(假设网页内嵌N个对象)时，
    服务器都需要N+1个不同的缓冲区。
- 持续连接，创建一个TCP连接获取网页的全部对象。
HTTP1.1默认指定了持续连接
    + 只需要为连接设定一组缓冲区和变量，并节省了连接建立和终止的往返时间
- HTTP本质上不提供安全，但可以在安全套接层(SSL)上运行，被称为HTTPS

### 请求报文
- 请求行
    + 方法, GET/PUT/POST/...
    + URL
    + 版本, 协议的版本，HTTP最常用的版本为1.1
- 首部行(Header), 客户端向服务器发送的额外信息
- 空行(CR+LF)
- 主体

### 响应报文
- 状态行
    + 版本, 协议的版本，HTTP最常用的版本为1.1
    + 状态码，请求的状态
    + 状态短语, 状态码的解释
- 首部行(Header)，服务器向客户端发送的额外信息
- 空行(CR+LF)
- 主体

## 代理服务器
- HTTP支持代理服务器(proxy server)
- 代理服务器能够保存最近请求的响应的副本，
通过检查本地高速缓存，若不存在响应报文，则将请求发送到相应的服务器。
返回的响应会发送到代理服务器，并进行存储，用于其他客户端将来的请求。
- 降低了原服务器的负载，减少了通信量并降低了延迟
- 为了使用代理服务器，必须配置客户端访问代理服务器。
- 提供不同的策略来进行缓存更新

## 文件传输协议FTP
- 用于传送大文件或使用不同格式传送文件
- FTP有2个连接
    + 控制连接，在客户和服务器的控制进程之间进行，端口21。
    在整个FTP会话期间都处于打开状态。
    + 数据连接，在客户和服务器的数据传输进程之间进行，服务器端使用端口20。
    每次传输文件时打开，然后传输完毕时关闭。

## 电子邮件(Email)
使用三组客户-服务器模型。

代理层
- 用户代理(UA, User Agent)
- 报文传输代理(MTA, Mail Transfer Agent)
    + 简单邮件传输协议(SMTP), 端口25, 它是一个推(push)协议
- 报文访问代理(MAA, Mail Access Agent)
    + 邮局协议v3(POP3), 端口110, 功能比较简单并且受到一定的限制。
    + 因特网邮件访问协议v4(IMAP4), 功能比较强。

### 多用途因特网邮件扩充(MIME, Multipurpose Internet Mail Extensions)
电子邮件的简单结构只能发送使用[NVT]()  7位ASCII格式的报文，
而不能发送其他格式的数据，例如其他语言，二进制，视频等。

MIME是一个辅助协议，将非ASCII数据转换为NVT ASCII数据。

MIME的结构
- 头部
    + 版本，当前版本1.1
    + 内容-类型，报文主体的数据类型
    + 内容-传送-编码，报文主体的编码方式
    + 内容-标识符
    + 内容-描述
- 主体

## TELNET
网络终端(TEminaL NETwork)的缩写。
它是不安全的，使用明文发送数据。

Telnet的工作流程
1. Telnet客户机将用户输入的字符转换为NVT ACSII字符，
发送给远程的Telnet服务器
2. Telnet服务器将NVT ACSII字符转换为之前用户输入的字符，
然后发送给**伪终端驱动程序**，然后伪终端将字符发送给操作系统，
操作系统再发送给适当的应用。

### 网络虚拟终端(NVT, Network Virtual Terminal)
NVT有两个字符集，都是8位的字符集
- 数据字符，最高位为0
- 控制字符，最高位为1

## SSH(Secure Shell)
SSH是一个有3个组件的应用层协议。
- SSH应用层协议(SSH-TRANS), 主要负责客户与服务器之间安全信道的建立
以及客户对服务器的认证
- SSH认证协议(SSH-AUTH), 主要负责服务器对客户的认证
- SSH连接协议(SSH-CONN), 基于前两层建立的安全信道，
来创建多个逻辑信道，用于不同的目的。

SSH分组格式
- 长度，分组长度但不包括填充块，4 bytes
- 填充块，1-8 bytes，使得攻击更困难
- 类型，1 byte，指明使用的分组类型
- 数据
- 循环冗余校验码(CRC)，4 bytes，用于错误检测

SSH**端口转发机制**会创建一个安全的**SSH隧道**，
其他协议的报文可以通过这个隧道进行发送，来确保安全。

## 域名系统DNS, Domain Name System

### 域名空间
定义为一个根在顶部的倒置树，树最多128级，0级为根结点。

- 标签，最多63个字符，根结点为空字符串
- 域名，完整的域名是用点(.)分割的标签序列
    + 全称域名(FQDN, full qualified domain name), 以点结束。
    + 部分域名(PQDN, partially qualified domain name)，
    当需要解析的部分域名和客户机相同的站点时，
    解析程序能够提供省略部分(即后缀)，以创建FQDN。
- 域(domain)，域名空间的子树，其名称是子树顶点结点的名称。
- 区域 && 区域文件，区域文件保存该域里所有结点的信息

### 高速缓存
加快名字-地址的解析

### 资源记录
资源记录是一个5元组接口
- 域名
- 类型，数值如何被解释
- 类别
- 生存时间TTL
- 数值，表示域名的信息

## P2P网络
- 集中式，目录系统来列出对等结点以及他们所提供的内容，使用客户-服务器模式；
但文件存储和下载使用P2P模式完成。
- 分散式
    + 非结构化
        * 查询效率不高，而且查询需要通过网络进行泛洪，造成极大的通信量
    + 结构化，采用一组预先确定的规则来连接节点
        * 分布式散列表(**DHT**, Distributed Hash Table)
            - [Chord]("https://en.wikipedia.org/wiki/Chord_(peer-to-peer)")
            - [Pastry]("https://en.wikipedia.org/wiki/Pastry_(DHT)")
            - [Kademlia](https://en.wikipedia.org/wiki/Kademlia)

# Reference
- [RFC](https://www.rfc-editor.org/)
- [NVT](http://baike.baidu.com/view/1739621.htm "NVT ASCII")
- 
